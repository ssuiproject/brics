/*
	* Mighty sort - Styleship alignment tools of list of the different vertical length type. 
	* Version 1.2.0
	* Edit 28.April.2015 
	* www.styleship.com
	* By Woos / Multimedia team Director;
	*
	* 본 소스는 법으로 보호되는 Styleship의 지적재산으로서
	* 본 제작자와 회사의 허가를 받지 않은 사용자 혹은 사이트에서 무단 사용시  
	* 민형사상의 처벌 및 배상이 따르게 됩니다.
	* 
	ⓒ Styleship inc. All Right Reserved. 
	*
	*	v.1.2.1		확실하지 않았던 정렬 순서에 대한 정리 완료. 코딩중의 이미지의 로딩 지연시 정렬 처리 해결
	*	v.1.2.0		refreshCoding 매서드 추가 : 정렬되는 리스트의 추가 혹은 삭제시 사용.
	*	v.1.1.2		dataXML 초기 설정시 미반영되는 현상 패치.
	*	v.1.1.1		xml data 추가시 '<content>'노드 한개당 '<li>'가 두개씩 생성되는 발생되는 버그 패치, 리사이즈시 스크롤이 최상단으로 올라가던 버그 패치
	*	v.1.1.0		가로 세로 방향의 마진값을 따로 적용하게 하기 위한 옵션 추가, 모순 옵션 방지 패치, 컨테이너 오브젝트 없이 설정될 경우 플러그인 무시 처리
	*	v.1.0.0		참을 수 없는 이전버전 플러그인 -티코타일의 잘못된 개발로 인한 맨땅에서 다시 만들어낸 플러그인
	
*/

function MightySort(a,b){return a.mightySort(b)}(function(a){a.fn.mightySort=function(f){var g=new Object();var q=this;g.content=this;var n=q.attr("id")?"#"+q.attr("id"):"."+q.attr("class").split(" ")[0];var m=a(this);if(m.size()==0){try{console.log("Does not exist Object of apply to mightySort.")}catch(r){}return}var k,o,u={},h={},b={},s=[],t=[];k={align:"center",autoResize:false,categoryList:["all"],dataXML:null,resizable:false,itemWidth:100,maxSortLine:null,minSortLine:1,margin:0,horizontalMargin:null,verticalMargin:null,orderList:["latest","oldest","view"],randomDelay:0,setCategory:"all",setOrder:"latest",speed:300};o=a.extend(k,f);(function(){o.align=o.align.toLowerCase();if(o.align!="center"&&o.align!="left"&&o.align!="right"&&o.align!="justify"){o.align="center"}if(l(o.categoryList)){o.categoryList=[o.categoryList]}if(o.maxSortLine==0){o.maxSortLine=null}if(o.margin<0){o.margin=0}if(o.horizontalMargin==null){o.horizontalMargin=o.margin}if(o.verticalMargin==null){o.verticalMargin=o.margin}if(l(o.orderList)){o.orderList=[o.orderList]}if(o.randomDelay<0){o.randomDelay=0}if(o.speed<0){o.speed=0}})();q.itemWidth;q.numItems=0;q.numCol=0;q.category=o.setCategory;q.order=o.setOrder;init=function(){c();if(o.dataXML){q.loadXML(o.dataXML,true)}q.sortCategory(o.setCategory);q.sortOrder(o.setOrder);u.enableResize=true;q.refresh(true);if(o.autoResize){h.resize()}};var b={data:null,step:null,wd:null,left:null,hg:0,build:function(){b.data=[];b.getWd();b.getMg()},getWd:function(){b.wd=m.width();b.hg=0;b.step=o.itemWidth+o.horizontalMargin;if(o.resizable){q.numCol=Math.max(o.minSortLine,Math.round((b.wd+o.horizontalMargin)/b.step))}else{q.numCol=Math.max(o.minSortLine,Math.floor((b.wd+o.horizontalMargin)/b.step))}if(o.maxSortLine){q.numCol=Math.min(o.maxSortLine,q.numCol)}if(o.resizable){q.itemWidth=Math.round((b.wd-(q.numCol-1)*o.horizontalMargin)/q.numCol)}else{q.itemWidth=o.itemWidth}for(var e=0;e<q.numCol;e++){b.data[e]=0}},getMg:function(){b.left=[];if(o.resizable){b.resizableMg()}else{b.fixMg()}},resizableMg:function(){b.step=(b.wd+o.horizontalMargin)/q.numCol;for(var e=0;e<q.numCol;e++){b.left.push(Math.round(b.step*e))}},fixMg:function(){var v;if(o.align=="left"){for(var e=0;e<q.numCol;e++){b.left.push(Math.round(b.step*e))}}else{if(o.align=="right"){v=b.wd-q.numCol*b.step;for(var e=0;e<q.numCol;e++){b.left.push(Math.round(b.step*e)+v)}}else{if(o.align=="justify"){if(q.numCol>1){v=(b.wd-q.numCol*o.itemWidth)/(q.numCol-1);for(var e=0;e<q.numCol;e++){if(e==0){b.left.push(0)}else{b.left.push(Math.round((o.itemWidth+v)*e))}}}else{b.left[0]=(b.wd-q.numCol*o.itemWidth)/2}}else{v=(b.wd-q.numCol*b.step)/2;for(var e=0;e<q.numCol;e++){b.left.push(Math.round(b.step*e)+v)}}}}},pos:function(y){var w,v;for(var e=0;e<b.data.length;e++){if(e==0){w=b.data[e];v=0}else{if(b.data[e]<w){w=b.data[e];v=e}}}var x=b.data[v];b.data[v]+=y.dom.height()+o.verticalMargin;if(b.data[v]>b.hg){b.hg=b.data[v]}return{pos:v,topValue:x,leftValue:b.left[v]}}};h={watchTime:null,compareWd:0,resize:function(){h.watchTime=setInterval(h.resizeHandler,1000/24)},resizeHandler:function(){if(!m){clearInterval(h.watchTime);h.watchTime=null;return}if(!u.enableResize){return}if(h.compareWd==m.width()){return}h.compareWd=m.width();q.refresh(false)}};function c(){q.numItems=m.children("li").size();m.children("li").each(function(e){var v=a(this);var w={no:e,dom:v,category:v.attr("data-category")?v.attr("data-category").split(" "):[],html:v.html(),order:{},pos:{topValue:null,leftValue:null,opacity:null},view:true};for(var e=0;e<o.orderList.length;e++){w.order[o.orderList[e]]=v.attr("data-"+o.orderList[e])}if(o.autoResize){w.dom.find("img").each(function(){var x=a(this);j(x)})}s.push(w)})}q.loadXML=function(e,w){if(!e){return}if(!l(e)){return}if(e.length<=4){return}if(w!=true){m.html("");s=new Array()}var v={url:e,dataType:"xml",success:d,error:function(z,A,y){if(o.debug_mode){try{console.log("요청 정보를 가져올 수 없습니다!  ("+y+")")}catch(x){}}}};a.ajax(v)};function d(v){var e=a(v).find("content");q.trigger({type:"datacomplete",dataType:"xml",xml:v});e.each(function(y,x){var z=a(this);var A={category:z.attr("data-category")?z.attr("data-category").split(" "):[],html:z.text(),order:{},pos:{topValue:null,leftValue:null,opacity:null},view:true};m.append("<li>"+A.html+"</li>");var w=m.children("li:last");if(z.attr("id")){w.attr("id",z.attr("id"))}if(z.attr("class")){w.attr("class",z.attr("class"))}if(z.attr("style")){w.attr("style",z.attr("style"))}if(z.attr("data-category")){w.attr("data-category",z.attr("data-category"))}for(var y=0;y<o.orderList.length;y++){if(z.attr("data-"+o.orderList[y])){A.order[o.orderList[y]]=z.attr("data-"+o.orderList[y]);w.attr("data-"+o.orderList[y],z.attr("data-"+o.orderList[y]))}else{A.order[o.orderList[y]]=null}}A.dom=w;if(o.autoResize){A.dom.find("img").each(function(){var B=a(this);j(B)})}s.push(A);q.numItems=m.children("li").size();q.trigger({type:"added",dataType:"xml",no:y,itemHTML:A.html,xml:v,target:A.dom})});q.trigger({type:"addcomplete",dataType:"xml",xml:v});q.refresh(true)}q.sortCategory=function(e){if(!e){t=s;q.category="all";return}if(l(e)){if(e.toLowerCase().split("all").length>1){t=s;q.category="all";return}e=e.split(" ")}else{if(e.join("").toLowerCase().split("all").length>1){t=s;q.category="all";return}}t=[];var y;for(var w=0;w<s.length;w++){y=false;for(var x=0;x<e.length;x++){categories=s[w].category;for(var v=0;v<categories.length;v++){if(categories[v]==e[x]){y=true}}}if(y){t.push(s[w])}}q.sortOrder()};q.sortOrder=function(v){if(!v){v=q.order}if(v=="latest"){t=s}else{if(v=="oldest"){t=[];for(var e=0;e<s.length;e++){t[e]=s[(s.length-e-1)]}}else{q.order=v;t.sort(function(x,w){var z=x.order[v];var y=w.order[v];return(z<y)?-1:(z>y)?1:0})}}};q.refresh=function(e){u.enableResize=false;setTimeout(function(){u.enableResize=true},o.speed);b.build();m.children("li").each(function(v){a(this).css({width:q.itemWidth,position:"absolute"})});i(e);p(e);m.css("height",b.hg)};q.refreshCoding=function(){q.numItems=m.children("li").size();s=[];m.children("li").each(function(e){var w=a(this);var x={no:e,dom:w,category:w.attr("data-category")?w.attr("data-category").split(" "):[],html:w.html(),order:{},pos:{topValue:null,leftValue:null,opacity:null},view:true};for(var v=0;v<o.orderList.length;v++){x.order[o.orderList[v]]=w.attr("data-"+o.orderList[v])}if(o.autoResize){x.dom.find("img").each(function(){var y=a(this);j(y)})}s.push(x)});t=s;q.sortCategory(q.category);q.sortOrder(q.order);q.refresh(true)};function i(v){if(o.speed<10){v=true}for(var e=0;e<s.length;e++){s[e].view=false}for(var e=0;e<t.length;e++){t[e].view=true}for(var e=0;e<s.length;e++){if(!s[e].view){if(!v){TweenMax.to(s[e].dom,o.speed/1000,{css:{opacity:0,display:"none"},overwrite:true,delay:Math.random()*o.speed/1000*0.5})}else{s[e].dom.css({opacity:0,display:"none"})}s[e].pos={pos:0,topValue:0,leftValue:0,opacity:0}}}}function p(v){if(o.speed<10){v=true}var x,w;for(var e=0;e<t.length;e++){x=b.pos(t[e]);x.opacity=1;w=t[e].dom;if(x.topValue!=t[e].pos.topValue||x.leftValue==t[e].pos.leftValue||t[e].pos.opacity==1){t[e].pos=x;if(!v){TweenMax.to(w,0.01,{css:{display:"block"},overwrite:true});TweenMax.to(w,o.speed*0.4/1000,{css:{opacity:1,left:x.leftValue,top:x.topValue,opacity:1},delay:Math.random()*o.speed/1000*0.6,ease:Quad.easeInOut})}else{w.css({opacity:1,display:"block",left:x.leftValue,top:x.topValue})}}}}function j(v){if(v.height()>0){return}if(v.attr("height")=="0"){return}var e=setInterval(function(){if(v.height()>0){clearInterval(e);q.refresh()}},1000/24)}function l(e){if(typeof(e)=="string"){return true}else{return false}}init();return q}})(jQuery);